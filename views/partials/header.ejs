<header class="header">
  <a href="/" class="header__logo">Blogy</a>

  <nav class="header__nav">
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/about">About</a></li>
      <li><a href="/contact">Contact</a></li>
      <li id="dashboardLink" style="display: none">
        <a href="/dashboard">Dashboard</a>
      </li>
    </ul>
  </nav>

  <div class="header__button">
    <button
      class="searchBtn"
      aria-expanded="false"
      aria-label="Search"
      id="searchButton"
      style="display: none"
    >
      Search
      <svg
        width="17"
        height="17"
        viewBox="0 0 17 17"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        role="img"
        aria-labelledby="searchIconTitle"
      >
        <title id="searchIconTitle">Search Icon</title>
        <path
          d="M7.79167 13.4583C10.9213 13.4583 13.4583 10.9213 13.4583 7.79167C13.4583 4.66205 10.9213 2.125 7.79167 2.125C4.66205 2.125 2.125 4.66205 2.125 7.79167C2.125 10.9213 4.66205 13.4583 7.79167 13.4583Z"
          stroke="black"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M14.875 14.875L11.7938 11.7938"
          stroke="black"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>

    <span style="margin-left: 50px"></span>

    <span id="auth-link">
      <a href="/login"></a>
    </span>
  </div>
</header>

<script>
  function updateAuthElements() {
    // Check local storage for cached auth data
    const cachedAuthData = JSON.parse(localStorage.getItem("authData"));

    if (cachedAuthData && cachedAuthData.loggedIn) {
      // Use cached data if available
      updateUI(cachedAuthData);
    } else {
      // Fetch from the server if no cached data or logged out
      fetch("/api/auth/status")
        .then((response) => response.json())
        .then((data) => {
          // Cache the response in local storage
          localStorage.setItem("authData", JSON.stringify(data));
          updateUI(data);
        })
        .catch((error) => console.error("Error fetching auth status:", error));
    }
  }

  function updateUI(data) {
    const authLink = document.getElementById("auth-link");
    const searchButton = document.getElementById("searchButton");
    const dashboardLink = document.getElementById("dashboardLink");

    if (data.loggedIn) {
      authLink.innerHTML = '<a href="/logout">Logout</a>';
      searchButton.style.display = "inline-block"; // Show search button if logged in

      if (data.role === "admin") {
        dashboardLink.style.display = "inline-block";
      } else {
        dashboardLink.style.display = "none";
      }
    } else {
      authLink.innerHTML = '<a href="/login">Login</a>';
      searchButton.style.display = "none"; // Hide search button if not logged in
      dashboardLink.style.display = "none"; // Hide dashboard link if not logged in
    }
  }

  // Clear local storage on logout
  document.addEventListener("click", (event) => {
    if (event.target.closest('a[href="/logout"]')) {
      localStorage.removeItem("authData");
    }
  });

  // Call the function on page load
  window.onload = updateAuthElements;
</script>
